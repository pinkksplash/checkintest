<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyStyleUs Check-in</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 0 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    p.intro {
      text-align: center;
      margin-bottom: 30px;
      font-size: 16px;
      color: #555;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      margin: 10px 10px 20px 10px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #0056b3;
    }
    form {
      max-width: 400px;
      margin: 0 auto 30px auto;
      background: white;
      padding: 20px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }
    th {
      background: #f2f2f2;
    }
    .hidden {
      display: none;
    }
    .confirm-section {
      text-align: center;
      margin-bottom: 30px;
    }
  </style>
</head>
<body>

  <h1>MyStyleUs Check-in</h1>
  <p class="intro">
    Hello beautiful! Welcome to your check-in portal.<br/>
    A 15-minute grace period is provided for your stylist to prepare your space.<br/>
    When your stylist is ready, check in here to start accurate timing.
  </p>

  <div style="text-align:center;">
    <button id="clientBtn">Client Check-in</button>
    <button id="stylistBtn">Stylist Check-in</button>
  </div>

  <!-- Check-in Form -->
  <form id="checkinForm" class="hidden">
    <h2 id="formTitle"></h2>
    <label for="nameInput">Your Name:</label>
    <input type="text" id="nameInput" required placeholder="Enter your name" />
    <label for="codeInput">Specialized Code:</label>
    <input type="text" id="codeInput" required placeholder="Enter your code" />
    <button type="submit">Check In</button>
  </form>

  <!-- Check-out Confirmation -->
  <div id="checkoutSection" class="confirm-section hidden">
    <p>Is your style complete and are you ready for payment?</p>
    <button id="checkoutBtn" style="background:#28a745;">Check Out & Pay</button>
  </div>

  <!-- Payment Confirmation -->
  <div id="paymentSection" class="confirm-section hidden">
    <p>Payment processed! Invoice sent to client. Stylist notified.</p>
    <button id="resetBtn" style="background:#007bff;">Start New Check-in</button>
  </div>

  <!-- Logs Table -->
  <table id="logTable" class="hidden">
    <thead>
      <tr>
        <th>Role</th>
        <th>Name</th>
        <th>Check-in Time</th>
        <th>Check-in Location</th>
        <th>Check-out Time</th>
        <th>Check-out Location</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  const clientBtn = document.getElementById('clientBtn');
  const stylistBtn = document.getElementById('stylistBtn');
  const checkinForm = document.getElementById('checkinForm');
  const formTitle = document.getElementById('formTitle');
  const nameInput = document.getElementById('nameInput');
  const codeInput = document.getElementById('codeInput');
  const checkoutSection = document.getElementById('checkoutSection');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const paymentSection = document.getElementById('paymentSection');
  const resetBtn = document.getElementById('resetBtn');
  const logTable = document.getElementById('logTable');
  const tbody = logTable.querySelector('tbody');

  let currentRole = '';
  let currentName = '';
  let currentCheckinTime = null;
  let currentCheckinCoords = null;
  let currentRow = null;

  function showCheckinForm(role) {
    currentRole = role;
    formTitle.textContent = `${role} Check-in`;
    nameInput.value = '';
    codeInput.value = '';
    checkinForm.classList.remove('hidden');
    checkoutSection.classList.add('hidden');
    paymentSection.classList.add('hidden');
  }

  clientBtn.onclick = () => showCheckinForm('Client');
  stylistBtn.onclick = () => showCheckinForm('Stylist');

  checkinForm.onsubmit = e => {
    e.preventDefault();

    const name = nameInput.value.trim();
    const code = codeInput.value.trim();

    if (!name) {
      alert('Please enter your name.');
      return;
    }
    if (!code) {
      alert('Please enter the specialized code.');
      return;
    }

    if (!navigator.geolocation) {
      alert('Geolocation is not supported by your browser.');
      return;
    }

    navigator.geolocation.getCurrentPosition(position => {
      currentName = name;
      currentCheckinTime = new Date();
      currentCheckinCoords = {
        lat: position.coords.latitude.toFixed(5),
        lon: position.coords.longitude.toFixed(5)
      };

      // Show the log table if hidden
      if (logTable.classList.contains('hidden')) {
        logTable.classList.remove('hidden');
      }

      // Add a new row with check-in info and placeholders for check-out
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${currentRole}</td>
        <td>${currentName}</td>
        <td>${currentCheckinTime.toLocaleString()}</td>
        <td>Lat: ${currentCheckinCoords.lat}, Lon: ${currentCheckinCoords.lon}</td>
        <td class="checkoutTime">-</td>
        <td class="checkoutLocation">-</td>
      `;
      tbody.appendChild(row);
      currentRow = row;

      checkinForm.classList.add('hidden');
      checkoutSection.classList.remove('hidden');

      alert(`${currentRole} checked in! Timer started.`);

    }, err => {
      alert('Failed to get location: ' + err.message);
    });
  };

  checkoutBtn.onclick = () => {
    if (!currentRow) {
      alert('No check-in record found.');
      return;
    }

    if (!navigator.geolocation) {
      alert('Geolocation is not supported by your browser.');
      return;
    }

    navigator.geolocation.getCurrentPosition(position => {
      const checkoutTime = new Date();
      const checkoutCoords = {
        lat: position.coords.latitude.toFixed(5),
        lon: position.coords.longitude.toFixed(5)
      };

      // Update the row with check-out data
      currentRow.querySelector('.checkoutTime').textContent = checkoutTime.toLocaleString();
      currentRow.querySelector('.checkoutLocation').textContent = `Lat: ${checkoutCoords.lat}, Lon: ${checkoutCoords.lon}`;

      checkoutSection.classList.add('hidden');
      paymentSection.classList.remove('hidden');
    }, err => {
      alert('Failed to get location: ' + err.message);
    });
  };

  resetBtn.onclick = () => {
    paymentSection.classList.add('hidden');
    currentRow = null;
    currentName = '';
    currentCheckinTime = null;
    currentCheckinCoords = null;
    showCheckinForm(''); // Show no form by default
  };
</script>

</body>
</html>
